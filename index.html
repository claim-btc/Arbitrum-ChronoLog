<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>ChronoLog â€” Eternal Memory</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@300;600;800&display=swap" rel="stylesheet">
  <script>
    window.tailwind = {
      config: {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: { sans: ['"Space Grotesk"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
            colors: { cyber: { dark: '#030307' } },
            animation: { 'blob': 'blob 20s infinite', 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'text-shimmer': 'textShimmer 3s linear infinite' },
            keyframes: {
              blob: { '0%': { transform: 'translate(0px, 0px) scale(1)' }, '33%': { transform: 'translate(30px, -50px) scale(1.1)' }, '66%': { transform: 'translate(-20px, 20px) scale(0.9)' }, '100%': { transform: 'translate(0px, 0px) scale(1)' } },
              textShimmer: { '0%, 100%': { 'background-size': '200% 200%', 'background-position': 'left center' }, '50%': { 'background-size': '200% 200%', 'background-position': 'right center' } }
            }
          }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>

  <style>
    /* --- æ ¸å¿ƒä¿®å¤ï¼šæ‰‹æœºç«¯æ—¥æœŸé€‰æ‹©å™¨ --- */
    input[type="datetime-local"] {
        /* å¼ºåˆ¶é‡ç½®ç§»åŠ¨ç«¯é»˜è®¤æ ·å¼ */
        appearance: none;
        -webkit-appearance: none;
        /* ç¡®ä¿æš—é»‘æ¨¡å¼ä¸‹å¯è§ */
        color-scheme: dark;
        /* ç¡®ä¿ç‚¹å‡»åŒºåŸŸè¶³å¤Ÿå¤§ä¸”åœ¨æœ€ä¸Šå±‚ */
        min-height: 50px;
        position: relative;
        z-index: 9999 !important; /* æ ¸å¼¹çº§å±‚çº§ */
        touch-action: manipulation; /* ä¼˜åŒ–è§¦æ§ */
        cursor: pointer;
    }
    /* ä¿®å¤ iOS ä¸Šè¾“å…¥æ¡†å¯èƒ½å‡ºç°å†…é˜´å½±çš„é—®é¢˜ */
    input[type="text"], textarea, input[type="datetime-local"] {
        -webkit-appearance: none;
        border-radius: 0.5rem; /* ä¿æŒåœ†è§’ */
    }

    /* å…¨å±€èƒŒæ™¯å’Œç»ç’ƒæ•ˆæœ */
    body {
      background-color: #030307;
      background-image: radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15), transparent 25%), radial-gradient(circle at 85% 30%, rgba(37, 99, 235, 0.15), transparent 25%);
      color: #e2e8f0; overflow-x: hidden; font-family: "Space Grotesk", sans-serif;
    }
    .glass-panel {
      background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    .btn-glow {
      background: linear-gradient(90deg, #4f46e5, #9333ea); background-size: 200% 200%; animation: textShimmer 3s ease infinite;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn-glow:hover:not(:disabled) { box-shadow: 0 0 20px rgba(124, 58, 237, 0.5); }
    * { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body class="antialiased min-h-screen relative">
  <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-purple-900/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob"></div>
    <div class="absolute top-[20%] right-[-10%] w-[400px] h-[400px] bg-blue-900/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob animation-delay-2000"></div>
  </div>
  <div id="root" class="relative z-10 px-4 py-8 md:py-16 max-w-5xl mx-auto"></div>

<script type="text/babel">
const CONTRACT_ADDRESS="0x1A46b403A29c8cBDA564E1f4B9c6332b8873532f",ARBITRUM_SEPOLIA_CHAIN_ID_DEC=421614;
const ABI=[{inputs:[{internalType:"string",name:"_content",type:"string"},{internalType:"uint256",name:"_unlockTime",type:"uint256"}],name:"createLog",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getAllLogs",outputs:[{components:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"address",name:"author",type:"address"},{internalType:"string",name":"content",type:"string"},{internalType:"uint256",name":"timestamp",type:"uint256"},{internalType:"uint256",name":"unlockTime",type:"uint256"}],internalType":"struct ChronoLog.Log[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"}];
const{useState,useEffect}=React,ethers=window.ethers;
function shortAddr(a=""){return a?a.slice(0,6)+"â€¦"+a.slice(-4):""}
function fmtTsUnixSec(s){try{const n=Number(s);return n?new Date(n*1000).toLocaleString(undefined,{dateStyle:'medium',timeStyle:'short'}):"-"}catch{return"-"}}
const LOGS_CACHE_KEY="chronolog_cache_v5";
function readLogsCache(){try{const r=localStorage.getItem(LOGS_CACHE_KEY);if(!r)return null;const o=JSON.parse(r);return(Date.now()-o.timestamp)>60000?null:o.data}catch{return null}}
function writeLogsCache(d){try{localStorage.setItem(LOGS_CACHE_KEY,JSON.stringify({timestamp:Date.now(),data:d}))}catch{}}
async function createWalletConnectProvider(){const r={};r[ARBITRUM_SEPOLIA_CHAIN_ID_DEC]="https://sepolia-rollup.arbitrum.io/rpc";if(!window.WalletConnectProvider)throw new Error("WalletConnect missing");const WCP=window.WalletConnectProvider.default||window.WalletConnectProvider;return new WCP({rpc:r,chainId:ARBITRUM_SEPOLIA_CHAIN_ID_DEC,qrcode:!0})}
function Notice({kind:k="info",children:c}){const clrs={error:"border-red-500/50 bg-red-900/20 text-red-200",success:"border-green-500/50 bg-green-900/20 text-green-200",info:"border-blue-500/50 bg-blue-900/20 text-blue-200"};return(<div className={`p-4 rounded-xl border backdrop-blur-md mb-6 animate-fade-in flex items-start gap-3 shadow-lg ${clrs[k]||clrs.info}`}><span className="text-xl mt-0.5">{k==='error'?'ğŸš¨':k==='success'?'âœ¨':'â„¹ï¸'}</span><span className="font-medium text-sm pt-1">{c}</span></div>)}

function App(){
  const[provider,setProvider]=useState(null),[signer,setSigner]=useState(null),[account,setAccount]=useState(null),[network,setNetwork]=useState(null),[contract,setContract]=useState(null);
  const[activeTab,setActiveTab]=useState("moment"),[loading,setLoading]=useState(!1),[notice,setNotice]=useState(null),[error,setError]=useState(null);
  const[momentContent,setMomentContent]=useState(""),[capsuleContent,setCapsuleContent]=useState(""),[capsuleUnlockAt,setCapsuleUnlockAt]=useState(""),[logs,setLogs]=useState([]),[refreshing,setRefreshing]=useState(!1);
  useEffect(()=>{const c=readLogsCache();if(c)setLogs(c)},[]);
  useEffect(()=>{if(notice||error){const t=setTimeout(()=>{setNotice(null);setError(null)},6000);return()=>clearTimeout(t)}},[notice,error]);
  useEffect(()=>{if(!provider){const rpc=new ethers.JsonRpcProvider("https://sepolia-rollup.arbitrum.io/rpc",{name:"Arbitrum Sepolia",chainId:ARBITRUM_SEPOLIA_CHAIN_ID_DEC});setContract(new ethers.Contract(CONTRACT_ADDRESS,ABI,rpc));setNetwork({chainId:BigInt(ARBITRUM_SEPOLIA_CHAIN_ID_DEC)});if(logs.length===0)fetchLogsInternal(new ethers.Contract(CONTRACT_ADDRESS,ABI,rpc))}},[provider]);
  async function connectInjected(){setError(null);setNotice(null);let t=window.okxwallet||window.ethereum;if(!t)return setError("Please install OKX Wallet.");try{setLoading(!0);await t.request({method:"eth_requestAccounts"});const p=new ethers.BrowserProvider(t,"any"),s=await p.getSigner(),addr=await s.getAddress(),net=await p.getNetwork();setProvider(p);setSigner(s);setAccount(addr);setNetwork(net);setContract(new ethers.Contract(CONTRACT_ADDRESS,ABI,s));setNotice("Wallet Connected: "+shortAddr(addr))}catch(e){setError(e.message)}finally{setLoading(!1)}}
  async function connectWC(){setError(null);setNotice(null);try{setLoading(!0);const wc=await createWalletConnectProvider();await wc.enable();const p=new ethers.BrowserProvider(wc,"any"),s=await p.getSigner(),addr=await s.getAddress(),net=await p.getNetwork();setProvider(p);setSigner(s);setAccount(addr);setNetwork(net);setContract(new ethers.Contract(CONTRACT_ADDRESS,ABI,s));setNotice("Mobile Connected: "+shortAddr(addr));wc.on("disconnect",()=>window.location.reload())}catch(e){setError("Connection failed")}finally{setLoading(!1)}}
  async function handleCreate(c,u){if(!signer)return setError("Wallet disconnected");if(!c.trim())return setError("Please write something");if(network.chainId!==BigInt(ARBITRUM_SEPOLIA_CHAIN_ID_DEC))return setError("Wrong Network! Switch to Arbitrum Sepolia");try{setLoading(!0);const tx=await contract.createLog(c,BigInt(u));setNotice("Broadcasting...");await tx.wait();setNotice("Successfully Etched! ğŸ‰");setMomentContent("");setCapsuleContent("");setCapsuleUnlockAt("");fetchLogs(!0)}catch(e){console.error(e);setError("Transaction Failed: "+(e.reason||e.message))}finally{setLoading(!1)}}
  async function fetchLogs(b){if(contract)fetchLogsInternal(contract,b)}
  async function fetchLogsInternal(c,b){setRefreshing(!0);try{if(!b){const cached=readLogsCache();if(cached){setLogs(cached);setRefreshing(!1);return}}const raw=await c.getAllLogs(),fmt=raw.map(r=>({id:Number(r.id),author:r.author,content:r.content,timestamp:Number(r.timestamp),unlockTime:Number(r.unlockTime)})).sort((a,b)=>b.id-a.id);setLogs(fmt);writeLogsCache(fmt)}catch(e){console.error(e)}finally{setRefreshing(!1)}}
  const isCorrectNet=network?.chainId===BigInt(ARBITRUM_SEPOLIA_CHAIN_ID_DEC);

  return (
    <div className="text-slate-200">
      <header className="flex flex-col md:flex-row justify-between items-center mb-10 animate-fade-in">
        <div className="text-center md:text-left mb-6 md:mb-0">
          <h1 className="text-5xl md:text-7xl font-extrabold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 animate-text-shimmer pb-2">ChronoLog</h1>
          <p className="font-mono text-xs md:text-sm text-slate-400 tracking-[0.2em] uppercase">Immutable â€¢ Eternal â€¢ Arbitrum</p>
        </div>
        {account?(<div className="glass-panel px-5 py-2 rounded-full flex items-center gap-3 animate-fade-in"><div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div><span className="font-mono text-sm text-green-300">{shortAddr(account)}</span></div>):(<div className="hidden md:block text-xs text-slate-500 font-mono">NOT CONNECTED</div>)}
      </header>
      {notice&&<Notice kind="success">{notice}</Notice>}{error&&<Notice kind="error">{error}</Notice>}
      {!account&&(
        <div className="glass-panel rounded-3xl p-8 md:p-12 text-center max-w-2xl mx-auto border-t border-white/10 shadow-2xl relative overflow-hidden group">
          <div className="absolute inset-0 bg-gradient-to-b from-indigo-500/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
          <div className="relative z-10">
            <div className="w-24 h-24 bg-gradient-to-tr from-indigo-600 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-8 shadow-xl transform rotate-3 group-hover:rotate-6 transition duration-300"><span className="text-4xl">ğŸ”—</span></div>
            <h2 className="text-3xl font-bold mb-3 text-white">Initialize Link</h2>
            <p className="text-slate-400 mb-10 max-w-md mx-auto">Connect your wallet to access the Arbitrum Sepolia timeline.</p>
            <div className="flex flex-col sm:flex-row gap-4 justify-center">
              <button onClick={connectInjected} className="btn-glow px-8 py-4 rounded-xl font-bold text-white flex items-center justify-center gap-2 transition transform hover:scale-105"><span>ğŸ’»</span> PC Connect</button>
              <button onClick={connectWC} className="glass-panel hover:bg-white/10 px-8 py-4 rounded-xl font-bold text-white flex items-center justify-center gap-2 transition transform hover:scale-105 border border-white/20"><span>ğŸ“±</span> Mobile QR</button>
            </div>
          </div>
        </div>
      )}
      {account&&(
        <main className="animate-fade-in">
          <div className="flex justify-center mb-10">
            <div className="glass-panel p-1 rounded-full flex gap-1">
              <button onClick={()=>setActiveTab("moment")} className={`px-8 py-3 rounded-full font-bold text-sm transition-all duration-300 ${activeTab==="moment"?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`}>âš¡ Moment</button>
              <button onClick={()=>setActiveTab("capsule")} className={`px-8 py-3 rounded-full font-bold text-sm transition-all duration-300 ${activeTab==="capsule"?"bg-purple-600 text-white shadow-lg":"text-slate-400 hover:text-white"}`}>â³ Capsule</button>
            </div>
          </div>
          <div className="glass-panel rounded-3xl p-1 mb-16 relative overflow-hidden">
             {!isCorrectNet&&(<div className="absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center"><span className="text-4xl mb-4">âš ï¸</span><h3 className="text-xl font-bold text-white mb-2">Wrong Network</h3><p className="text-slate-400 mb-6">Please switch to <span className="text-blue-400">Arbitrum Sepolia</span></p></div>)}
            <div className="bg-[#0a0a0f] rounded-[1.4rem] p-6 md:p-8 border border-white/5 relative z-10">
              {activeTab==="moment"?(
                <div className="animate-fade-in">
                  <textarea value={momentContent} onChange={(e)=>setMomentContent(e.target.value)} placeholder="Record this moment forever..." className="w-full bg-transparent text-lg md:text-xl text-white placeholder-slate-600 border-none focus:ring-0 resize-none h-32 font-sans"></textarea>
                  <div className="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-4"></div>
                  <div className="flex justify-between items-center"><span className="text-[10px] text-slate-500 font-mono tracking-widest">MODE: INSTANT</span><button disabled={loading} onClick={()=>handleCreate(momentContent,0)} className="btn-glow px-8 py-3 rounded-lg text-sm font-bold text-white disabled:opacity-50 disabled:grayscale transition">{loading?"ETCHING...":"ETCH MOMENT"}</button></div>
                </div>
              ):(
                <div className="animate-fade-in">
                  <textarea value={capsuleContent} onChange={(e)=>setCapsuleContent(e.target.value)} placeholder="Write a message to the future..." className="w-full bg-transparent text-lg md:text-xl text-white placeholder-slate-600 border-none focus:ring-0 resize-none h-32 font-sans"></textarea>
                  <div className="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-6"></div>
                  <div className="flex flex-col md:flex-row gap-6 items-center justify-between">
                    <div className="w-full md:w-auto relative">
                      <label className="block text-[10px] text-slate-500 font-mono tracking-widest mb-2 uppercase">Unlock Date</label>
                      {/* ä¿®å¤åçš„æ—¥æœŸè¾“å…¥æ¡†: ç§»é™¤å¤æ‚çš„çˆ¶çº§å®¹å™¨æ ·å¼ï¼Œç›´æ¥æš´éœ² input */}
                      <input type="datetime-local" value={capsuleUnlockAt} onChange={(e)=>setCapsuleUnlockAt(e.target.value)} className="w-full md:w-64 bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-purple-500 transition cursor-pointer"/>
                    </div>
                    <button disabled={loading} onClick={()=>{if(!capsuleUnlockAt)return setError("Set a date first");const ts=Math.floor(new Date(capsuleUnlockAt).getTime()/1000);if(ts<=Date.now()/1000)return setError("Date must be in future");handleCreate(capsuleContent,ts)}} className="w-full md:w-auto bg-purple-600 hover:bg-purple-500 px-8 py-3 rounded-lg text-sm font-bold text-white shadow-lg shadow-purple-900/40 transition disabled:opacity-50">{loading?"SEALING...":"SEAL CAPSULE"}</button>
                  </div>
                </div>
              )}
            </div>
          </div>
          <div className="flex items-center justify-between mb-8 px-2"><h2 className="text-xl font-bold flex items-center gap-3"><span className="w-2 h-6 bg-indigo-500 rounded-full"></span>Timeline</h2><button onClick={()=>fetchLogs(!0)} className="text-xs font-mono text-slate-500 hover:text-white transition">{refreshing?"SYNCING...":"[ REFRESH ]"}</button></div>
          <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {logs.map((log)=>{const isLocked=log.unlockTime>Date.now()/1000;return(<article key={log.id} className="glass-panel rounded-2xl p-6 relative group hover:-translate-y-1 transition-all duration-300"><div className="flex justify-between items-start mb-4"><div className={`text-[10px] font-bold px-2 py-1 rounded border tracking-wider ${isLocked?"bg-amber-500/10 border-amber-500/30 text-amber-300":"bg-cyan-500/10 border-cyan-500/30 text-cyan-300"}`}>{isLocked?"ğŸ”’ LOCKED":"âš¡ OPEN"}</div><span className="font-mono text-[10px] text-slate-600">#{log.id}</span></div><div className="mb-6 min-h-[4rem]">{isLocked?(<div className="h-full flex flex-col justify-center items-center text-center border border-dashed border-slate-700 rounded-lg p-4 bg-black/20"><span className="text-2xl mb-2 opacity-50">â³</span><span className="text-xs font-mono text-slate-500">Unlocks on<br/>{fmtTsUnixSec(log.unlockTime)}</span></div>):(<p className="text-slate-200 text-sm leading-relaxed whitespace-pre-wrap font-light">{log.content}</p>)}</div><div className="pt-4 border-t border-white/5 flex justify-between items-center text-[10px] text-slate-500 font-mono"><span className="truncate max-w-[100px]">{shortAddr(log.author)}</span><span>{fmtTsUnixSec(log.timestamp)}</span></div></article>)})}
          </div>
          {logs.length===0&&!refreshing&&(<div className="text-center py-20 opacity-50 font-mono text-sm">/ NO MEMORIES FOUND /</div>)}
        </main>
      )}
      <footer className="mt-24 pb-8 text-center"><div className="w-12 h-1 bg-gradient-to-r from-indigo-500 to-purple-500 mx-auto rounded-full mb-6"></div><p className="text-slate-600 text-xs font-mono">SECURED BY ARBITRUM SEPOLIA</p></footer>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
